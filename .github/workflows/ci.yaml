name: rules_swiftnav

on:
  pull_request: ~
  push:
    branches:
      - 'main'

jobs:
  check-formatting:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v5

      - uses: bazelbuild/setup-bazelisk@v3

      - name: Mount bazel cache
        uses: actions/cache@v4
        with:
          path: "~/.cache/bazel"
          key: bazel

      - name: Run format
        run: |
          bazel run //:buildifier
          git diff --exit-code

  small-world-integration-project:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v5

      - uses: bazelbuild/setup-bazelisk@v3

      - name: Mount bazel cache
        uses: actions/cache@v4
        with:
          path: "~/.cache/bazel"
          key: bazel

      - name: Run format
        run: |
          cd test/small_world
          bazel build //...
          ./scripts/generate_coverage.sh
